
import os
import time
import random
import logging
import datetime
import pytz
import requests

TOKEN = "7194435988:AAGfGHdjMigOTj14XlANeVtO-QnD0I0yXps"
USER_ID = "6184719147"

# –°–æ–æ–±—â–µ–Ω–∏—è
messages = {
    "morning": [
        "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –∑–∞—è! –ü–æ–¥–∫–ª—é—á–∏ –∑–∞—Ä—è–¥–∫—É, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞‚ù§Ô∏è.",
        "–ó–∞—Ä—è–¥–∫–∞ ‚Äî –∑–∞–ª–æ–≥ –∑–¥–æ—Ä–æ–≤—å—è. –ù–∞—á–∏–Ω–∞–π!",
        "–£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞–±–æ—Ç–∞üòâ: –Ω–µ –∑–∞–±—É–¥—å –∑–∞—Ä—è–¥–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω.",
        "7:30 ‚Äî —Ç—ã –∑–∞—Ä—è–¥–∏–ª–∞—Å—å —ç–Ω–µ—Ä–≥–∏–µ–π?",
        "–ü–æ—Ä–∞–¥—É–π –º–µ–Ω—è ‚Äî –ø–æ—Ä–∞–¥—É–π —Ç–µ–ª–µ—Ñ–æ–Ω! –í—Å—Ç–∞–≤–ª—è–π üòâ",
        "–Ø –≤—Å—ë –µ—â—ë –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ —Ç–µ–ª–µ—Ñ–æ–Ω —É–∂–µ –Ω–∞ –∑–∞—Ä—è–¥–∫–µ.",
        "8:00 ‚Äî –≤—Å—ë –µ—â—ë 13%?",
        "–õ—é–±–∏–º–∞—è, –∑–∞—Ä—è–¥–∫–∞ –Ω–µ —à—É—Ç–∫–∞. –•–∏—Ö–∏–∫!",
        "–¢—ã –∂–µ –∑–Ω–∞–µ—à—å, —è —É—Ç–æ–º–ª—é)) –¥–∞–≤–∞–π - –∑–∞—Ä—è–∂–∞–π)."
    ],
    "evening": [
        "–í–µ—á–µ—Ä–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –∑–∞—Ä—è–¥–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞?",
        "–ù–µ–∂–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞—é: –ø–æ—Ä–∞ –∑–∞—Ä—è–∂–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω.",
        "21:00 ‚Äî –∞ –∑–∞—Ä—è–¥–∫–∞?",
        "22:00 ‚Äî –µ—â—ë –Ω–µ –Ω–∞ –∑–∞—Ä—è–¥–∫–µ?",
        "–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å! –ü–æ—Å—Ç–∞–≤—å —Ç–µ–ª–µ—Ñ–æ–Ω –Ω–∞ –∑–∞—Ä—è–¥–∫—É.",
        "–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –≤ —Å–µ–º—å–µ ‚Äî –∑–∞—Ä—è–¥–∫–∞ –≤ –≥–Ω–µ–∑–¥–µ.",
        "–°–¥–µ–ª–∞–π —Ö–æ—Ä–æ—à–æ - –≤—Å—Ç–∞–≤—å –ø–æ–≥–ª—É–±–∂–µ."
    ],
    "late": [
        "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏ –ª–æ–∂–∏—Å—å —Å–ø–∞—Ç—å.",
        "–¢—ã —Ç–æ—á–Ω–æ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –æ–Ω —É–º–µ—Ä?-–¥–µ–π—Å—Ç–≤—É–π!",
        "–Ø –Ω–µ —à—É—á—É. –ü–æ–¥–∫–ª—é—á–∏ –∑–∞—Ä—è–¥–∫—É.",
        "–ú—ã –≤ –æ—Ç–≤–µ—Ç–µ –∑–∞ —Ç–µ—Ö, –∫–æ–≥–æ –Ω–µ –∑–∞—Ä—è–∂–∞–µ–º.",
        "–î–∞–∂–µ –∫–æ–≥–¥–∞ —è —Å–ø–ª—é - –±–æ—Ç —Å–ª–µ–¥–∏—Ç.",
        "–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–≤–æ–Ω–æ–∫. –ò–ª–∏ –ø–æ—Ç–æ–º –±—É–¥–µ—Ç –∑–≤–æ–Ω–∫–∞).",
        "–ï—Å–ª–∏ –Ω–µ –Ω–∞ –∑–∞—Ä—è–¥–∫–µ ‚Äî —è –ø–ª–∞–∫–∞—Ç—å."
    ],
    "special": "—è –∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å –ê–Ω–¥—Ä–µ—è –ú–∞–∫—Å–∏–º–æ–≤–∏—á–∞ –ø–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞—Ä—è–¥–∫–∏. –û–Ω –í–∞—Å –±–µ–∑—É–º–Ω–æ –ª—é–±–∏—Ç –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç, —á—Ç–æ –í—ã –µ–≥–æ –ø–æ–∫–æ—Ä–Ω–∞—è –ì–æ—Å–ø–æ–∂–∞"
}

# –í—Ä–µ–º—è –ø–æ –ë–µ—Ä–ª–∏–Ω—É
berlin = pytz.timezone("Europe/Berlin")

# –ß–∞—Å—ã –æ—Ç–ø—Ä–∞–≤–∫–∏
schedule = {
    "morning": [7, 7.5, 8, 8.5, 9],
    "evening": [15, 20, 21, 22],
    "late": [23],
    "special": [17.5]
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
def get_current_hour():
    now = datetime.datetime.now(berlin)
    return now.hour + now.minute / 60.0

def send_message(text):
    url = f"https://api.telegram.org/bot{TOKEN}/sendMessage"
    payload = {"chat_id": USER_ID, "text": text}
    try:
        requests.post(url, data=payload)
    except Exception as e:
        logging.error(f"Error sending message: {e}")

def main():
    hour = get_current_hour()
    logging.basicConfig(filename="bot_log.txt", level=logging.INFO)
    logging.info(f"{datetime.datetime.now(berlin)} | Executed hour: {hour}")

    tasks = 0
    for period, times in schedule.items():
        for t in times:
            if abs(hour - t) < 0.1:
                if period == "special":
                    send_message(messages["special"])
                else:
                    send_message(random.choice(messages[period]))
                tasks += 1
                break

    logging.info(f"{datetime.datetime.now(berlin)} | Executed hour: {hour}, tasks={tasks}")

if __name__ == "__main__":
    main()
